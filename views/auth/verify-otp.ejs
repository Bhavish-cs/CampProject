<% layout('layouts/boilerplate') %>

    <div class="auth-container">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-5 col-lg-4">
                    <div class="auth-card">
                        <h2 class="auth-title">Verify Your Email</h2>
                        <p class="auth-subtitle">We sent a 6-digit code to<br><strong>
                                <%= email %>
                            </strong></p>

                        <!-- OTP Verification Form -->
                        <form action="/verify-otp" method="POST">
                            <div class="form-floating">
                                <input type="text" class="form-control text-center" id="otp" name="otp"
                                    placeholder="000000" maxlength="6" pattern="[0-9]{6}" required
                                    style="font-size: 24px; letter-spacing: 8px; font-weight: 600;">
                                <label for="otp">Enter 6-digit OTP</label>
                                <div class="form-text-enhanced">
                                    <i class="bi bi-clock"></i>
                                    Code expires in 10 minutes
                                </div>
                            </div>

                            <button type="submit" class="btn btn-auth-success w-100 mb-3">
                                Verify & Sign In
                            </button>
                        </form>

                        <!-- Resend OTP -->
                        <div class="text-center mb-3">
                            <form action="/resend-otp" method="POST" class="d-inline">
                                <button type="submit" class="btn btn-link auth-link p-0" style="font-size: 0.9rem;">
                                    Didn't receive the code? Resend OTP
                                </button>
                            </form>
                        </div>

                        <div class="text-center">
                            <a href="/login" class="auth-link">
                                <i class="bi bi-arrow-left"></i> Back to Sign In
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced OTP input functionality
        document.addEventListener('DOMContentLoaded', function () {
            const otpInput = document.getElementById('otp');

            // Auto-focus OTP input
            otpInput.focus();

            otpInput.addEventListener('input', function (e) {
                // Only allow numbers
                this.value = this.value.replace(/[^0-9]/g, '');

                // Auto-submit when 6 digits are entered
                if (this.value.length === 6) {
                    // Add loading state
                    const submitBtn = document.querySelector('button[type="submit"]');
                    submitBtn.classList.add('btn-loading');
                    submitBtn.textContent = 'Verifying...';

                    // Submit form
                    setTimeout(() => {
                        this.form.submit();
                    }, 500);
                }
            });

            // Handle paste event
            otpInput.addEventListener('paste', function (e) {
                e.preventDefault();
                const paste = (e.clipboardData || window.clipboardData).getData('text');
                const numbers = paste.replace(/[^0-9]/g, '').substring(0, 6);
                this.value = numbers;

                if (numbers.length === 6) {
                    this.form.submit();
                }
            });
        });
    </script>